/* InstantClick 3.1.0 | (C) 2014 Alexandre Dieulot | http://instantclick.io/license */
/* With portions (C) 2015 Joe Strommen */
var InstantClick=function(d,f){function w(a){var b=a.indexOf("#");return 0>b?a:a.substr(0,b)}function y(a){for(;a&&"A"!=a.nodeName;)a=a.parentNode;return a}function K(a){var b=d.implementation.createHTMLDocument("");b.documentElement.innerHTML=a.replace(/<noscript[\s\S]+<\/noscript>/gi,"");return b}function z(a){var b=f.protocol+"//"+f.host;if(!(b=a.target||a.hasAttribute("download")||0!=a.href.indexOf(b+"/")||-1<a.href.indexOf("#")&&w(a.href)==h)){if(L){a:{do{if(!a.hasAttribute)break;if(a.hasAttribute("data-no-instant"))break;
if(a.hasAttribute("data-instant")){a=!0;break a}}while(a=a.parentNode);a=!1}a=!a}else a:{do{if(!a.hasAttribute)break;if(a.hasAttribute("data-instant"))break;if(a.hasAttribute("data-no-instant")){a=!0;break a}}while(a=a.parentNode);a=!1}b=a}return b?!1:!0}function t(a,b,c,e){for(var d=!1,f=0;f<A[a].length;f++)if("receive"==a){var g=A[a][f](b,c,e);g&&("body"in g&&(c=g.body),"title"in g&&(e=g.title),d=g)}else A[a][f](b,c,e);return d}function M(a,b,c,e){G?G(b):d.documentElement.replaceChild(b,d.body);
if(c){history.pushState(null,null,c);b=c.indexOf("#");b=-1<b&&d.getElementById(c.substr(b+1));e=0;if(b)for(;b.offsetParent;)e+=b.offsetTop,b=b.offsetParent;scrollTo(0,e);h=w(c)}else scrollTo(0,e);d.title=U&&d.title==a?a+String.fromCharCode(160):a;N();B.done();t("change",!1);a=d.createEvent("HTMLEvents");a.initEvent("instantclick:newpage",!0,!0);dispatchEvent(a)}function O(a){H>+new Date-500||(a=y(a.target))&&z(a)&&x(a.href)}function P(a){H>+new Date-500||(a=y(a.target))&&z(a)&&(a.addEventListener("mouseout",
V),I?(Q=a.href,k=setTimeout(x,I)):x(a.href))}function W(a){H=+new Date;(a=y(a.target))&&z(a)&&(C?a.removeEventListener("mousedown",O):a.removeEventListener("mouseover",P),x(a.href))}function X(a){var b=y(a.target);!b||!z(b)||1<a.which||a.metaKey||a.ctrlKey||(a.preventDefault(),R(b.href))}function V(){k?(clearTimeout(k),k=!1):u&&!l&&(m.abort(),l=u=!1)}function Y(){if(!(4>m.readyState)&&0!=m.status){p.ready=+new Date-p.start;if(m.getResponseHeader("Content-Type").match(/\/(x|ht|xht)ml/)){var a=m.responseText,
b=K(a);D=b.title;v=b.body;var c=t("receive",q,v,D);c&&("body"in c&&(v=c.body),"title"in c&&(D=c.title));c=w(q);r[c]={documentHTML:a,scrollY:c in r?r[c].scrollY:0};for(var a=b.head.children,b=0,e,c=a.length-1;0<=c;c--)if(e=a[c],e.hasAttribute("data-instant-track")){e=e.getAttribute("href")||e.getAttribute("src")||e.innerHTML;for(var d=E.length-1;0<=d;d--)E[d]==e&&b++}b!=E.length&&(F=!0)}else F=!0;l&&(l=!1,R(q))}}function N(a){d.body.addEventListener("touchstart",W,!0);C?d.body.addEventListener("mousedown",
O,!0):d.body.addEventListener("mouseover",P,!0);d.body.addEventListener("click",X,!0);if(!a){a=d.body.getElementsByTagName("script");var b,c,e,f;i=0;for(j=a.length;i<j;i++)b=a[i],b.hasAttribute("data-no-instant")||(c=d.createElement("script"),b.src&&(c.src=b.src),b.innerHTML&&(c.innerHTML=b.innerHTML),e=b.parentNode,f=b.nextSibling,e.removeChild(b),e.insertBefore(c,f))}}function x(a){!C&&"display"in p&&100>+new Date-(p.start+p.display)||(k&&(clearTimeout(k),k=!1),a||(a=Q),u&&(a==q||l))||(u=!0,l=!1,
q=a,F=v=!1,p={start:+new Date},t("fetch"),m.open("GET",a),m.send())}function R(a){"display"in p||(p.display=+new Date-p.start);k||!u?k&&q&&q!=a?f.href=a:(x(a),B.start(0,!0),t("wait"),l=!0):l?f.href=a:F?f.href=q:v?(r[h].scrollY=pageYOffset,l=u=!1,M(D,v,q)):(B.start(0,!0),t("wait"),l=!0)}var J=navigator.userAgent,U=-1<J.indexOf(" CriOS/"),S="createTouch"in d,h,Q,k,H,r={},m,q=!1,D=!1,F=!1,v=!1,p={},u=!1,l=!1,E=[],G,L,C,I,A={fetch:[],receive:[],wait:[],change:[]},B=function(){function a(a,f){n=a;d.getElementById(g.id)&&
d.body.removeChild(g);g.style.opacity="1";d.getElementById(g.id)&&d.body.removeChild(g);e();f&&setTimeout(b,0);clearTimeout(m);m=setTimeout(c,500)}function b(){n=10;e()}function c(){n+=1+2*Math.random();98<=n?n=98:m=setTimeout(c,500);e()}function e(){h.style[k]="translate("+n+"%)";d.getElementById(g.id)||d.body.appendChild(g)}function f(){d.getElementById(g.id)?(clearTimeout(m),n=100,e(),g.style.opacity="0"):(a(100==n?0:n),setTimeout(f,0))}function l(){g.style.left=pageXOffset+"px";g.style.width=
innerWidth+"px";g.style.top=pageYOffset+"px";var a="orientation"in window&&90==Math.abs(orientation);g.style[k]="scaleY("+innerWidth/screen[a?"height":"width"]*2+")"}var g,h,k,n,m;return{init:function(){g=d.createElement("div");g.id="instantclick";h=d.createElement("div");h.id="instantclick-bar";h.className="instantclick-bar";g.appendChild(h);var a=["Webkit","Moz","O"];k="transform";if(!(k in h.style))for(var b=0;3>b;b++)a[b]+"Transform"in h.style&&(k=a[b]+"Transform");var c="transition";if(!(c in
h.style))for(b=0;3>b;b++)a[b]+"Transition"in h.style&&(c="-"+a[b].toLowerCase()+"-"+c);a=d.createElement("style");a.innerHTML="#instantclick{position:"+(S?"absolute":"fixed")+";top:0;left:0;width:100%;pointer-events:none;z-index:2147483647;"+c+":opacity .25s .1s}.instantclick-bar{background:#29d;width:100%;margin-left:-100%;height:2px;"+c+":all .25s}";d.head.appendChild(a);S&&(l(),addEventListener("resize",l),addEventListener("scroll",l))},start:a,done:f}}(),T="pushState"in history&&(!J.match("Android")||
J.match("Chrome/"))&&"file:"!=f.protocol;return{supported:T,init:function(){if(!h)if(T){for(var a=arguments.length-1;0<=a;a--){var b=arguments[a];"function"===typeof b?G=b:!0===b?L=!0:"mousedown"==b?C=!0:"number"==typeof b&&(I=b)}h=w(f.href);r[h]={documentText:d.documentElement.outerHTML,scrollY:pageYOffset};for(var b=d.head.children,c,a=b.length-1;0<=a;a--)c=b[a],c.hasAttribute("data-instant-track")&&(c=c.getAttribute("href")||c.getAttribute("src")||c.innerHTML,E.push(c));m=new XMLHttpRequest;m.addEventListener("readystatechange",
Y);N(!0);B.init();t("change",!0);addEventListener("popstate",function(){var a=w(f.href);if(a!=h)if(a in r){r[h].scrollY=pageYOffset;h=a;var b=K(r[a].documentHTML);M(b.title,b.body,!1,r[a].scrollY)}else f.href=f.href})}else t("change",!0)},on:function(a,b){A[a].push(b)}}}(document,location);
